proxy.jQuery.wait(function(){function Stuck(element,options){if(element){var defaults={threshholdTarget:element.parent(),additionalTopValue:0,fixedPosition:{top:100,marginTop:0,marginBottom:0,marginLeft:0,width:"auto"},scrollEventName:FD.scrollTracker&&FD.scrollTracker.eventName,respectBottomThreshhold:!1,onActive:function(){},isActive:function(){var vp=FD.viewports.viewport();return"sm"===vp.name||"md"===vp.name||"lg"===vp.name}};return this.element=element.jquery?element:$(element),this.settings=$.extend(!0,{},defaults,options||{}),this.init(),this.id=options.id||FD.Page.getUniqueId(),this.useRelativePosition=this.element.data("useRelativePosition"),this}return new Error("No element for $.fn.stuck() to stick.")}var pluginName="stuck";Stuck.prototype.init=function(){var self=this;self.offset=self.element.offset(),self.position=self.element.position(),$(window).one("resize",function(){self.resize()}),self.listenForScroll()},Stuck.prototype.getThreshhold=function(scrollData,fixedPosition){var self=this,settings=self.settings,elementOffset=self.offset,target=settings.threshholdTarget,marginBottom=settings.fixedPosition.marginBottom||0,threshhold={};return threshhold=1==self.useRelativePosition?{top:target.position().top,left:elementOffset.left+scrollData.viewport.left,bottom:target.position().top+target.height()-self.element.height()-marginBottom}:{top:target.offset().top+settings.additionalTopValue-fixedPosition.top,left:elementOffset.left+scrollData.viewport.left,bottom:target.offset().top+target.height()-self.element.height()-marginBottom}},Stuck.prototype.getFixedPosition=function(scrollData){var self=this,settings=self.settings,elementOffset=self.offset,marginLeft=self.element.css("marginLeft")||"0",marginTop=settings.fixedPosition.marginTop||0,width=settings.fixedPosition.width||void 0,fixedPosition={top:settings.fixedPosition.top+marginTop,left:scrollData.viewport.left+elementOffset.left-parseInt(marginLeft,10)+settings.fixedPosition.marginLeft,width:width};return fixedPosition},Stuck.prototype.setPosition=function(scrollData){var self=this,settings=self.settings,element=this.element,top=scrollData.viewport.top,fixedPosition=self.getFixedPosition(scrollData),threshhold=self.getThreshhold(scrollData,fixedPosition),hasStyle=!!element.attr("style"),belowTopThreshhold=threshhold.top-top<=0,aboveBottomThreshold=threshhold.bottom-top>0,withinThreshhold=belowTopThreshhold&&aboveBottomThreshold,isStuckActive=settings.isActive();isStuckActive?(settings.onActive&&settings.onActive(scrollData),settings.respectBottomThreshhold?withinThreshhold?("undefined"!=typeof fixedPosition.width?element.css({position:"fixed",top:fixedPosition.top+"px",left:fixedPosition.left+"px",width:fixedPosition.width+"px"}):element.css({position:"fixed",top:fixedPosition.top+"px",left:fixedPosition.left+"px"}),FD.publish("fd.stuck.on",element)):(element.removeAttr("style"),FD.publish("fd.stuck.off",element)):belowTopThreshhold?hasStyle||(element.css({position:"fixed",top:fixedPosition.top+"px",left:fixedPosition.left+"px"}),FD.publish("fd.stuck.on",element)):(element.removeAttr("style"),FD.publish("fd.stuck.off",element))):element.removeAttr("style")},Stuck.prototype.listenForScroll=function(){var self=this;FD.scrollTracker&&FD.subscribe(self.settings.scrollEventName,function(data){self.setPosition(data)})},Stuck.prototype.resize=function(){this.element.removeAttr("style"),this.init(),$(window).scroll()},$.fn[pluginName]=function(options){var self=this;return this.each(function(){var element=$(this),isStuck=element.data("fd.stuck"),stuck=isStuck?new Error("stuck already loaded for this element"):new Stuck(element,options);stuck.constructor&&"Error"==stuck.constructor.name||element.data("fd.stuck",stuck)}),self}}),proxy.FD.push(["Session.onConfig",function(){function Asset(record){if(!record)return null;var asset=this;asset._record=record,asset.setRecordType().mapFields().setCssClassNames().setTopRibbonText().checkUserProfileUrl().setModTime().setPublishDate().truncateTitle().initType().setPhotoUrl().doTemplate().storeAsset()}function truncateText(str,maxLines,maxLineWidth,charWidths){charWidths=charWidths||fontWidths.brandon.black20,maxLines=maxLines||3,maxLineWidth=maxLineWidth||169,str=str.trim();var words=str.split(" "),line="",lines=[],wordLength=0,widths=words.map(function(word,i,a){var x=0,len=word.length,w=0;for(x;len>x;x++)w+=charWidths[word.charCodeAt(x)]||20;return w});return widths.forEach(function(len,i,a){var maxWidth=line.contains(/[^a-zA-Z\d\s]/g)?maxLineWidth-2:maxLineWidth;wordLength+=len;var space=i<widths.length-1?" ":"";wordLength>maxWidth&&(wordLength=len,lines.push(fixHyphens(line)),line=""),line+=words[i]+space,i==widths.length-1&&lines.push(fixHyphens(line))}),lines.slice(0,maxLines).reduce(function(a,c,i,o){var result=a+c;return i==o.length-1&&(result=result.trim().Trim(/[^a-zA-Z\d]$/),lines.length>maxLines&&(result+="&hellip;")),result})}function fixHyphens(text){if(!text)return"";var re=/.+-\s.+/g;return re.test(text)?text.replace(/-\s/g,"-"):text}function spaceSpecialChars(text){return text?text.replace(/-/g,"- ").replace(/\(/g," (").replace(/\)/g,") ").replace(/\s+/g," "):""}var util=FD.Util,fontWidths={brandon:{black20:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,7,8,12,12,14,15,5,8,8,8,12,7,8,6,8,13,8,11,11,13,12,12,11,12,12,6,6,10,11,10,10,21,14,13,14,16,13,12,15,16,8,9,14,11,19,16,17,13,17,14,12,11,15,14,19,14,13,12,8,8,8,11,10,7,14,13,14,16,13,12,15,16,8,9,14,11,19,16,17,13,17,14,12,11,15,14,19,14,13,12,9,4,9,12],bold20:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,7,8,12,12,14,15,4,8,8,8,12,6,8,6,8,14,8,11,11,13,12,12,11,12,12,6,6,10,11,10,10,21,14,13,15,16,13,12,15,16,7,9,14,11,18,16,17,13,17,14,12,11,15,14,19,14,13,12,8,8,8,11,9,7,14,13,15,16,13,12,15,16,7,9,14,11,18,16,17,13,17,14,12,11,15,14,19,14,13,12,9,5,9,12]}},spec={selector:{tile:".gk-tile",template:{"default":'script[type="text/html-template"][id]',tile:"#tile-asset"}},pattern:{url:{article:"/article/a-{0}",howto:"/howto/h-{0}",recipe:"/{0}",review:"/recipe/r-{0}/review",photo:"{0}?photo={1}",member:"/user/{0}","package":"",subpackage:"",topic:"",video:""}}},dataMap={recipe:{primary_category_name:"category",main_description:"description",recipe_id:"id",latest_modtime:"modTime",recipe_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",recipe_sponsorcode:"sponsorCode",main_title:"title",record_url:"url",folder:"folder",folderItemByline:"folderItemByline",folderItemId:"folderItemId",has_photo:"hasPhoto",main_rating:"ratingAvg",main_num_ratings:"ratingCount",main_rating_mapping:"ratingMax",main_submit_date:"recipeSubmitDate",num_steps:"stepCount",main_truncated_title:"titleTruncated",user_avatar_url:"userAvatarUrl",recipe_user_url:"userProfileUrl",main_userid:"userId",main_username:"displayName"},privaterecipe:{primary_category_name:"category",main_description:"description",recipe_id:"id",latest_modtime:"modTime",recipe_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",main_title:"title",truncated_title:"titleTruncated",record_url:"url",has_photo:"hasPhoto",user_avatar_url:"userAvatarUrl",recipe_user_url:"userProfileUrl",main_userid:"userId",main_username:"displayName",main_submit_date:"recipeSubmitDate",num_steps:"stepCount",main_truncated_title:"titleTruncated"},fdcrecipe:{recipe_photo_url:"photoUrl",record_spec:"recordSpec",recordType:"recordType",title:"title",truncated_title:"titleTruncated",url:"url",user_avatar_url:"userAvatarUrl",recipe_user_url:"userProfileUrl",folderItemId:"folderItemId",folderItemByline:"folderItemByline",folder:"folder"},activityrecipe:{recipeId:"id",recipeUrl:"url",recipeTitle:"title",avgRating:"ratingAvg",reviewCount:"ratingCount",memberId:"userId",memberName:"displayName",memberProfileUrl:"userProfileUrl",memberAvatar:"userAvatarUrl",dateModified:"modTime",photo:"photoUrl",cookTime:"totalTime"},userfolder:{description:"description",folderId:"id",folderItemCount:"folderItemCount",photo_url:"photoUrl",recordType:"recordType",title:"title",truncated_title:"titleTruncated",url:"url",user_name:"displayName"},galleryphototile:{photoUrl:"photoUrl",photoId:"photoId",isPrivate:"isPrivate",shareUrl:"shareUrl",likeCount:"likeCount",likeItemType:"likeItemType",recipeTitle:"recipeTitle",truncated_title:"titleTruncated",liked:"liked",memberName:"memberName",memberProfileUrl:"memberProfileUrl",memberAvatar:"memberAvatar",text:"text",rating:"rating",hideEditIcon:"hideEditIcon",editPhotoUrl:"editPhotoUrl",tailHtml:"tailHtml",dateModified:"modDate"},galleryvideotile:{photoUrl:"photoUrl",videoUrl:"videoUrl",text:"text",truncated_title:"titleTruncated",tailHtml:"tailHtml",shareUrl:"shareUrl"},galleryctatile:{recipeId:"recipeId"},review:{primary_category_name:"category",main_description:"description",review_id:"id",latest_modtime:"modTime",member_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",main_title:"title",truncated_title:"titleTruncated",review_content:"content",review_rating:"rating",main_rating:"ratingAvg",main_num_ratings:"ratingCount",review_parent_id:"recipeId",review_submit_date:"reviewDate",review_username:"reviewDisplayName",review_userid:"reviewUserId",user_avatar_url:"userAvatarUrl",main_userid:"userId",main_username:"displayName"},photo:{primary_category_name:"category",main_description:"description",photo_id:"id",latest_modtime:"modTime",photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",main_title:"title",truncated_title:"titleTruncated",recipe_cooktime:"cookTime",photo_height:"photoHeight",photo_username:"photoUserDisplayName",photo_userid:"photoUserId",photo_width:"photoWidth",recipe_preptime:"prepTime",main_rating:"ratingAvg",main_num_ratings:"ratingCount",main_submit_date:"recipeSubmitDate",photo_parent_url:"recipeUrl",main_username:"recipeUserDisplayName",main_userid:"recipeUserId",recipe_totaltime:"totalTime",user_avatar_url:"userAvatarUrl"},contributorinfo:{memberName:"memberName",profileUrl:"profileUrl",avatarUrl:"avatarUrl",userStatus:"userStatus",recipesCount:"recipesCount",tweaksCount:"tweaksCount",photosCount:"photosCount",bntCaption:"bntCaption",viewedByRecipeOwner:"viewedByRecipeOwner",viewedByLoggedInUser:"viewedByLoggedInUser"},relevantcontent:{},relevantcontentitem:{meta:"meta",title:"title",photo:"photoUrl",url:"url",showPlayIcon:"showPlayIcon",truncated_title:"titleTruncated",main_username:"displayName",main_rating:"ratingAvg",main_num_ratings:"ratingCount",user_url:"userProfileUrl",isRecipe:"isRecipe"},reciperelatedvideo:{title:"title",photo:"photo",url:"url",duration:"duration"},slideshow:{primary_category_name:"category",description:"description",ss_id:"id",modtime:"modTime",primary_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",sponsor_code:"sponsorCode",title:"title",truncated_title:"titleTruncated",record_url:"url",publish_date:"publishDate",no_of_slides:"slideCount",isWidescale:"isWidescale"},member:{has_photo:"hasPhoto",has_recipe:"hasRecipe",has_review:"hasReview",main_submit_date:"memberSince",member_about:"description",member_fname:"firstName",member_id:"id",member_lname:"lastName",member_photo_blur_url:"userAvatarBlurUrl",member_photo_url:"photoUrl",member_username:"title",modtime:"modTime",record_spec:"recordSpec",record_type:"recordType",record_url:"url",user_id:"userId"},gktalent:{has_photo:"hasPhoto",main_submit_date:"memberSince",main_username:"displayName",member_id:"id",member_photo_url:"photoUrl",modtime:"modTime",primary_photo_url:"userAvatarUrl",recipe_user_first_name:"firstName",recipe_user_last_name:"lastName",record_type:"recordType",record_url:"url",title:"title",topRibbonText:"label",truncated_title:"titleTruncated",user_id:"userId"},user:{blurPhotoUrl:"blurPhotoUrl",displayName:"displayName",id:"id",record_type:"record_type",photoUrl:"photoUrl",type:"type",url:"url",userAvatarUrl:"userAvatarUrl"},video:{description:"description",member_photo_blur_url:"userAvatarBlurUrl",member_photo_url:"photoUrl",modtime:"modTime",primary_category_name:"category",primary_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",record_url:"url",running_time:"duration",showName:"showName",sponsor_code:"sponsorCode",title:"title",truncated_title:"titleTruncated",video_id:"id"},howto:{primary_category_name:"category",description:"description",how_to_id:"id",main_submit_date:"modTime",primary_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",sponsor_code:"sponsorCode",title:"title",truncated_title:"titleTruncated",record_url:"url",member_username:"userAbout",user_avatar_url:"userAvatarUrl",user_url:"userProfileUrl",user_name:"userDisplayName"},article:{primary_category_name:"category",description:"description",article_id:"id",primary_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",title:"title",truncated_title:"titleTruncated",record_url:"url",user_avatar_url:"userAvatarUrl",user_name:"userDisplayName",user_url:"userProfileUrl"},news:{primary_category_name:"category",description:"description",article_id:"id",primary_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",title:"title",truncated_title:"titleTruncated",record_url:"url",user_avatar_url:"userAvatarUrl",user_name:"userDisplayName",user_url:"userProfileUrl",publish_date:"publishDate"},topic:{primary_category_name:"category",topic_description:"description",topic_id:"id",feat_rec_photo_file:"photoUrl",record_spec:"recordSpec",record_type:"recordType",topic_name:"title",truncated_title:"titleTruncated",record_url:"url",num_recipes:"recipeCount"},gkshow:{description:"description",label:"label",layout:"layout",primary_photo_url:"photoUrl",recordType:"recordType",record_type:"GkShow",record_url:"url",title:"title",topRibbonText:"topRibbonText",truncated_title:"titleTruncated"},ingredient:{primary_category_name:"category",description:"description",ingred_id:"id",modtime:"modTime",main_submit_date:"modDate",primary_photo_url:"photoUrl",record_spec:"recordSpec",record_type:"recordType",title:"title",truncated_title:"titleTruncated",record_url:"url"},gkcollection:{description:"description",label:"label",layout:"layout",primary_photo_url:"photoUrl",recordType:"recordType",record_type:"GkCollection",record_url:"url",title:"title",topRibbonText:"topRibbonText",truncated_title:"titleTruncated"}};FD.Assets={};var screen=FD.viewports.viewport()&&FD.viewports.viewport().name&&FD.viewports.viewport().name.toLowerCase(),FULL_SIZE_PHOTO_XS={w:598,h:250,flags:"progressive",quality:80,mode:"fill"},FULL_SIZE_PHOTO_MD={w:735,h:372,flags:"progressive",quality:80,mode:"fill"},RECIPE_SIZE_PHOTO_XS={w:140,h:105,flags:"progressive",quality:80,mode:"fill"},RECIPE_SIZE_PHOTO_MD={w:232,h:180,flags:"progressive",quality:80,mode:"fill"},TILE_FEATURE_PHOTO={w:483,h:372,flags:"progressive",quality:80,mode:"fill"},TILE_FEATURE_PHOTO_FULL={w:966,h:372,flags:"progressive",quality:80,mode:"fill"},TILE_PHOTO={w:231,h:372,flags:"progressive",quality:80,mode:"fill"},buildPhotoPresets=function(screen){return{xs:{recipe:RECIPE_SIZE_PHOTO_XS,article:FULL_SIZE_PHOTO_XS,video:FULL_SIZE_PHOTO_XS,gkcollection:FULL_SIZE_PHOTO_XS,topic:FULL_SIZE_PHOTO_XS,howto:FULL_SIZE_PHOTO_XS,slideshow:FULL_SIZE_PHOTO_XS,photo:FULL_SIZE_PHOTO_XS,galleryvideotile:FULL_SIZE_PHOTO_XS,galleryphototile:FULL_SIZE_PHOTO_XS,feature:TILE_FEATURE_PHOTO,featureFull:TILE_FEATURE_PHOTO_FULL,DEFAULT:FULL_SIZE_PHOTO_XS},md:{recipe:RECIPE_SIZE_PHOTO_MD,article:FULL_SIZE_PHOTO_MD,video:FULL_SIZE_PHOTO_MD,gkcollection:FULL_SIZE_PHOTO_MD,topic:FULL_SIZE_PHOTO_MD,howto:FULL_SIZE_PHOTO_MD,slideshow:TILE_PHOTO,photo:FULL_SIZE_PHOTO_MD,galleryvideotile:FULL_SIZE_PHOTO_MD,galleryphototile:FULL_SIZE_PHOTO_MD,feature:TILE_FEATURE_PHOTO,featureFull:TILE_FEATURE_PHOTO_FULL,DEFAULT:FULL_SIZE_PHOTO_MD},sm:{recipe:RECIPE_SIZE_PHOTO_MD,article:FULL_SIZE_PHOTO_MD,video:FULL_SIZE_PHOTO_MD,gkcollection:FULL_SIZE_PHOTO_MD,topic:FULL_SIZE_PHOTO_MD,howto:FULL_SIZE_PHOTO_MD,slideshow:TILE_PHOTO,photo:FULL_SIZE_PHOTO_MD,galleryvideotile:FULL_SIZE_PHOTO_MD,galleryphototile:FULL_SIZE_PHOTO_MD,feature:TILE_FEATURE_PHOTO,featureFull:TILE_FEATURE_PHOTO_FULL,DEFAULT:FULL_SIZE_PHOTO_MD}}[screen]},photoPresets=buildPhotoPresets(screen);Asset.prototype.setRecordType=function(){var asset=this,record=asset._record,recordType=record.record_type||record.recordType||record.RecordType;!recordType&&record.record_spec&&(recordType=record.record_spec.split("-")[0]),asset.type=recordType.toLowerCase();var extendedTitle=["news"];return asset.extendedTitle=extendedTitle.contains(asset.type),asset},Asset.prototype.mapFields=function(){var asset=this,record=asset._record,recordType=asset.type;if(recordType){var map=dataMap[recordType];for(var field in record)map[field]&&record[field]&&(asset[map[field]]=record[field])}return asset},Asset.prototype.setCssClassNames=function(){var asset=this,record=asset._record;return"news"==asset.type&&"full"==record.layout?asset.cssClassNames="gk-tile-full":record.cssClassNames&&(asset.cssClassNames=record.cssClassNames),asset},Asset.prototype.setTopRibbonText=function(){var asset=this,record=asset._record;return record.topRibbonText&&(asset.topRibbonText=record.topRibbonText),asset},Asset.prototype.checkUserProfileUrl=function(){var asset=this,url=new FD.Url(asset.userProfileUrl);if(asset.userProfileUrl){var path=url.path,parts=path.split("https://www.food.com/"),length=parts.length;2!==length||isNaN(parts[1])?(3!==length||3===length&&"user"!=parts[1])&&(asset.userProfileUrl=null):(parts[0]="user",url.path="/"+parts.join("https://www.food.com/"),asset.userProfileUrl=url.toString())}return asset},Asset.prototype.setModTime=function(){var asset=this;return asset.modTime&&(asset.modTime=moment(asset.modTime+"Z").from((new Date).getTime(),!0)),asset},Asset.prototype.setPublishDate=function(){var asset=this;return asset.publishDate&&(moment(parseInt(asset.publishDate)).year()<1980?asset.publishDate="":asset.publishDate=moment(parseInt(asset.publishDate)).format("MMM  DD, YYYY")),asset},Asset.prototype.truncateTitle=function(){var asset=this;return asset.titleTruncated=asset.getTruncatedTitle(),asset},Asset.prototype.getTruncatedTitle=function(){var asset=this;if(!asset.title)return"";var isNews="news"==asset.type,maxLines=isNews?6:3,maxLineWidth=isNews?169:197,vp=FD.viewports.viewport(),isXs="xs"==vp.name,isRecipe="recipe"==asset.type,charWidths=isRecipe?fontWidths.brandon.bold20:fontWidths.brandon.black20,truncated=asset.isFeature||isXs?asset.title:truncateText(spaceSpecialChars(asset.title),maxLines,maxLineWidth,charWidths);return truncated},window.determineCharWidth=function(tileSelector){tileSelector=tileSelector||spec.selector.tile;var char,charWidth,charMin=32,charMax=127,$tile=$(tileSelector).eq(2),$title=$tile.find("h2.title a"),$h2=$title.parent(),title=$title.text(),x=1,isGk=".gk-tile"==tileSelector,ttlWidth=isGk?$title.width():$h2.width(),charWidths=[];for($title.text(title),charWidths[0]=$h2.width()-parseInt($title.css("padding-left"))-parseInt($title.css("padding-right")),x;charMin>x;x++)charWidths[x]=0;for(x;charMax>x;x++)char=String.fromCharCode(x)," "==char?$title.html("&nbsp;"):$title.text(char),charWidth=isGk?$title.width()-ttlWidth:$title.width(),charWidths[x]=charWidth;window.charWidths=charWidths},Asset.prototype.initType=function(){var asset=this;return asset[asset.type]?asset[asset.type]():"user"==asset.type?asset.member():"gktalent"==asset.type&&(asset.type="user",asset.isTalent=!0,asset.member()),asset},Asset.prototype.recipe=function(){var asset=this,record=asset._record;if(asset.type="recipe",asset.truncatedTitle&&(asset.title=asset.truncatedTitle),asset.ratingAvg){var rating=asset.ratingAvg;asset.reviewState=0===asset.reviewCount?"hide":"",asset.rating=util.CookTime.prototype.formatDecimal(rating),asset.percentRating=100*(rating?rating/5:0)+"%"}record.recipe_cooktime&&(asset._cooktime=new util.CookTime(record.recipe_cooktime||0),asset.cookTime=asset._cooktime.toString()),record.recipe_totaltime&&(asset._totaltime=new util.CookTime(record.recipe_totaltime||0),asset.totalTime=asset._totaltime.toString()),asset.ratingCountAbbr=FD.Util.number.abbreviate(asset.ratingCount)},Asset.prototype.relevantcontentitem=function(){var asset=this;if(asset.ratingAvg){var rating=asset.ratingAvg;asset.percentRating=100*(rating?rating/5:0)+"%"}asset.ratingCountAbbr=FD.Util.number.abbreviate(asset.ratingCount)},Asset.prototype.activityrecipe=function(){var asset=this;asset.type="recipe"},Asset.prototype.privaterecipe=function(){var asset=this;asset.recipe()},Asset.prototype.fdcrecipe=function(){var asset=this,record=asset._record,recipeUrl=new FD.Url(https://www.food.com/asset.url),recipeUrlPath=recipeUrl.path.split("https://www.food.com/"),slug=recipeUrlPath.length>1&&recipeUrlPath[recipeUrlPath.length-1].split("-")||"";asset.id=slug.length>1&&slug[slug.length-1]||"",asset.noUser=record.recipe_user_url?"":"fd-nouser",asset.recipe()},Asset.prototype.userfolder=function(){var asset=this;asset.itemType="Recipes",asset.itemCount=asset.folderItemCount||0},Asset.prototype.review=function(){var asset=this,record=asset._record,pattern=spec.pattern.url.review;asset.content.length>120&&(asset.content=asset.content.substr(0,117)+"..."),asset.url=pattern.format([record.review.parent_id])},Asset.prototype.photo=function(){var asset=this,record=asset._record,pattern=spec.pattern.url.photo;asset.url=pattern.format([record.photo_parent_url,record.photo_id])},Asset.prototype.article=function(){var asset=this;asset.label="Article"},Asset.prototype.news=function(){var asset=this;asset.label="News",asset.hasTag=!0,asset.templateId="tile-asset"},Asset.prototype.howto=function(){var asset=this;asset.label="Step-by-Step"},Asset.prototype.video=function(){var asset=this;asset.assetIcon="icon-fdc-play",asset.duration=asset.duration||"0:00"},Asset.prototype.topic=function(){var asset=this;asset.label="Top Recipes"},Asset.prototype.gkshow=function(){var asset=this;asset.label="Show"},Asset.prototype.slideshow=function(){var asset=this;asset.label="Photos",asset.assetIcon="icon-fdc-photo-gallery",asset.itemType="Photos",asset.itemCount=asset.slideCount||0,asset.title=asset.title||"Title Unknown",asset._record.record_spec.startsWith("tier4")&&(asset.label="More About")},Asset.prototype.ingredient=function(){var asset=this;asset.label="The 411"},Asset.prototype.member=function(){var asset=this,blurPhotoUrl=asset.blurPhotoUrl||asset.userAvatarUrl;asset.photoUrl=asset.userAvatarUrl,asset.blurPhotoUrl=FD.Page.Image.blurPhoto({url:blurPhotoUrl,params:{w:231,effects:"blur:1000"}}),asset.displayName||(asset.firstName&&asset.lastName?asset.displayName=asset.firstName+" "+asset.lastName.substr(0,1):asset.displayName="user-"+asset.id)},Asset.prototype.setPhotoUrl=function(){var photoSize,asset=this,vp=FD.viewports.viewport();if(asset.hasPhoto=!!asset.photoUrl,asset.photoUrl=asset.hasPhoto?asset.photoUrl:"",asset.noPhoto=this.hasPhoto?"":"fd-nophoto",!asset.hasPhoto)return asset;if(!asset.photoUrl.startsWith("http")&&!asset.photoUrl.startsWith("//"))return asset.photoUrl="",asset;"undefined"==typeof photoPresets&&(photoPresets=buildPhotoPresets(vp.name)),asset.photoUrlOriginal=asset.photoUrl.replace("/$template$",""),asset.initialPhotoUrl=asset.photoUrl;var isFeatureFull=asset.cssClassNames&&asset.cssClassNames.contains("fd-tile-quadro"),isFeatureDouble=asset.cssClassNames&&asset.cssClassNames.contains("fd-tile-double");if(asset.isFeature=isFeatureFull||isFeatureDouble,asset.photoUrl.contains("\\$template\\$"))asset.photoUrl=asset.photoUrl.replace("$template$",FD.Page.Image.getCloudinaryParams(photoPresets[asset.type]));else{if(asset.isFeature){var isFull="full"===asset._record.layout;photoSize=isFull?photoPresets.featureFull:photoPresets.feature,"slideshow"===asset.type&&asset.cssClassNames.contains("top-gallery-slideshow")&&(asset.cssClassNames="","sm"===vp.name&&(photoSize=photoPresets[asset.type]))}else photoSize=asset.type in photoPresets?"slideshow"===asset.type&&asset.isWidescale?photoPresets.DEFAULT:photoPresets[asset.type]:photoPresets.DEFAULT;asset.photoUrl=FD.Page.Image.resize(asset.photoUrl,photoSize,"photo")}return asset},Asset.prototype.doTemplate=function(){var asset=this;if(FD.Page.render||(FD.Page.render={tile:{}}),FD.Page.render.tile||(FD.Page.render.tile={}),!FD.Page.render.tile[asset.type]){var typeSelector="#tile-"+asset.type,tileSelector=spec.selector.template.tile,$tmpl=$(typeSelector);0===$tmpl.length&&($tmpl=$(tileSelector)),FD.Page.render.tile[asset.type]=doT.template($tmpl.html())}return asset.render=function(){return FD.Page.render.tile[asset.type](asset)},asset},Asset.prototype.storeAsset=function(){var asset=this;if(FD.Assets){FD.Assets[asset.type]||(FD.Assets[asset.type]={});var assets=FD.Assets[asset.type];assets[asset.id]=asset}return asset},FD.Util.Asset=Asset}]),function(){"use strict";function FeaturePromo(options){var self=this;self.settings=$.extend(!0,{},defaults,options||{}),proxy.FD.push(["Session.onConfig",function(){self.init()}])}var defaults={data:{currentPromoIndex:0},moduleName:"gk-feature-promo",className:{left:"dir-left",right:"dir-right"},photoSettings:{md:{w:1025,h:437,mode:"fill",q:80}},selector:{arrow:".btn-arrow",carousel:".gk-feature-carousel",cta:".gk-fp-cta",featurePromo:".gk-feature-promo",links:".gk-fp-link",tile:".gk-home-tile",tilesContainer:".gk-feature-tiles"}};FeaturePromo.prototype={init:function(){var self=this;self.getData(),self.setEventHandlers().autoRotate()},getData:function(){var self=this,vp=FD.viewports.viewport(),photoSettings={};photoSettings=vp.name in self.settings.photoSettings?self.settings.photoSettings[vp.name]:self.settings.photoSettings.md,self.promos=FD.Data.featurePromo.map(function(promo){return promo.photo&&promo.photo.length>0&&(promo.photo=FD.Page.Image.resize(promo.photo,photoSettings,"photo")),promo})},setEventHandlers:function(){var self=this,settings=self.settings,className=settings.className,selector=settings.selector,arrow=selector.arrow,cta=selector.cta,tile=selector.tile,$featurePromo=$(selector.featurePromo);return $featurePromo.on("click",arrow,function(){var $this=$(this);settings.autoRotate&&clearInterval(settings.autoRotate),$this.hasClass(className.right)?self.updatePromo("next"):self.updatePromo("prev")}).on("click",cta,function(event){event.preventDefault(),self.goTo($(this))}).on("click",tile,function(){self.goTo($(this))}),self},autoRotate:function(){var self=this,settings=self.settings,vp=FD.viewports.viewport();vp.screen.width<1025||(settings.autoRotate=setInterval(function(){self.updatePromo("next")},7500))},goTo:function($elem){window.location.href=$elem.data("url")},updatePromo:function(dir){var self=this,settings=self.settings,data=settings.data,selector=settings.selector,$feature=$(selector.featurePromo),$carousel=$(selector.carousel),$title=$feature.find("h1 a"),$cta=$feature.find(selector.cta);"next"===dir?data.currentPromoIndex=2===data.currentPromoIndex?0:data.currentPromoIndex+1:data.currentPromoIndex=0===data.currentPromoIndex?2:data.currentPromoIndex-1,data.currentPromo=self.promos[data.currentPromoIndex],$carousel.animate({opacity:0},200,function(){$title.text(data.currentPromo.label),$cta.text(data.currentPromo.CTA).data("url",data.currentPromo.HREF),$feature.find(selector.links).attr("href",data.currentPromo.HREF),$carousel.css("background-image",'url("'+data.currentPromo.photo+'")')}).animate({opacity:1},200)}},proxy.FD.extend(["Module.FeaturePromo",FeaturePromo]),proxy.FD.push(["publish","feature-promo-loaded"])}(),function(){function NewRecipes(options){var self=this;self.settings=$.extend(!0,{},defaults,options||{}),self.init()}var defaults={selector:{module:{spinner:".fd-spinner",tileContainer:".tile-container"},target:{"new":".target-new-recipes",trending:".target-trending-recipes"},templates:".module-new-recipes",page:{body:"body"}},service:{get:{"new":"/external/v1/nlp/newestRecipes",trending:"/external/v1/nlp/trendingRecipes"}}};NewRecipes.prototype={init:function(){var self=this,settings=self.settings,templates=settings.selector.templates;FD.Util.createRenderFunctions(self,templates),self.renderModule(),settings.$request=self.getRecipeData(),settings.$request.done(function(data){settings.data=data.response.results,self.prepData(settings.data).renderTiles(settings.data)}).fail(function(jqXHR,status,errorThrown){self.removeModule()})},getRecipeData:function(){var self=this,settings=self.settings,service=settings.service,url=FD.Config.secureServerURL+service.get[settings.moduleType];return $.ajax({url:url,cache:!1,type:"GET",dataType:"json",xhrFields:{withCredentials:!0}})},prepData:function(data){var self=this,settings=self.settings;return data=data.slice(0,5),$.each(data,function(index,item){item.userProfileUrl=FD.Config.serverURL+"/user/"+item.main_userid,item.ratingPercentage=self.convertRating(item.main_rating)}),settings.data=data,self},convertRating:function(num){return num/5*100},removeModule:function(){var self=this,settings=self.settings,moduleType=settings.moduleType,$module=$(settings.selector.target[moduleType]);$module.remove()},renderModule:function(){var self=this,settings=self.settings,moduleType=settings.moduleType,$target=$(settings.selector.target[moduleType]),data={moduleTitle:$target.data("title"),viewAllLink:function(){var uri="new"===moduleType?"/recipe/all/newest":"/recipe/all/trending";return FD.Config.serverURL+uri}()},module=self.render.newRecipesContainer(data);$target.append(module)},renderTiles:function(data){var tile,self=this,settings=self.settings,selector=settings.selector,module=selector.module,$target=$(selector.target[settings.moduleType]).find(module.tileContainer);return $target.find(module.spinner).remove(),data&&0!==data.length||self.removeModule(),$.each(data,function(index,item){tile=self.render.basicTile(item),$target.append(tile)}),self}},proxy.FD.extend(["Module.NewRecipes",NewRecipes])}(),proxy.jQuery.wait(function(){function AllActivity(options){var self=this,vp=FD.viewports.viewport();self.settings=$.extend(!0,{},defaults,options||{}),self.settings.viewport=vp.name;var secSvrUrl=FD.Config.secureServerURL,noGet=!self.settings.service.get;(noGet||!self.settings.service.get.startsWith("http"))&&(noGet||self.settings.service.get.startsWith("https://www.food.com/")||(secSvrUrl+="https://www.food.com/"),self.settings.service.get=secSvrUrl+self.settings.service.get),self.init()}var defaults={adInterval:5,className:{active:"active",errorFeed:"error-feed",liked:"true",loadingFeed:"loading-feed",loadMoreClass:"gk-aa-load-more",tileContainer:"gk-aa-tiles",tileView:"tile-view"},event:{pageView:"fd.omniture.pageview.fire"},filters:["recipes","photos","reviews","tweaks","questions","saves","follows","following","followers"],markup:{},pageType:"",selector:{ad:{bigbox:".gk-aa-ad-col .dfp-bigbox .dfp > div",slot:".ad-slot"},dropdown:".gk-aa-filters-dropdown .gk-dropdown__select",feed:{container:".gk-aa-feed-items",item:".gk-aa-item",like:".gk-aa-like",likeCount:".gk-aa-count",loadMoreBtn:".gk-aa-load-more",spinner:".gk-aa-feed .loading-feed",text:".gk-aa-item-text",tile:".fd-tile",title:".gk-aa-feed-title",wrap:".gk-aa-wrap"},filter:".gk-aa-filters li",filterPanel:".gk-aa-filters",headingFollow:".user-followers, .user-following",htmlBody:"html, body",page:".fd-page-profile",sticky:".gk-sticky",templates:".module-gk-aa"},renderFunc:"feedItem",service:{get:"/external/v1/feed",post:function(recipeId){return FD.Config.secureServerURL+"/external/v1/recipes/"+recipeId+"/feed"},pn:1},state:{activeFilter:"",firstLoad:!0,loadMoreClicked:!1,renderedItems:0,view:"default"},tileFilters:["/recipes","/saves","/follows","/followers"]};AllActivity.prototype={init:function(){var $filter,urlFilter,self=this,selector=self.settings.selector,vp=FD.viewports.viewport();self.setEventHandlers(),FD.Util.createRenderFunctions(self,selector.templates),self.createMessageTiles().insertLoadingSpinner(),"xs"!==vp.name&&self.stickifyElements(),urlFilter=self.checkQueryParams(),"talent"===self.settings.mode&&"undefined"==typeof urlFilter&&(urlFilter="recipes"),urlFilter&&(self.activateFilter(urlFilter).updateFeedTitle(null,urlFilter.charAt(0).toUpperCase()+urlFilter.slice(1)),
$filter=self.getFilterElement(urlFilter),self.updateTileView($filter));var results=self.loadResults();results&&results.then(function(response){return self.renderLoadMoreBtn(),response})},loadMore:function($btn){var self=this,settings=self.settings,state=self.settings.state;state.loadMoreClicked=!0,$btn&&$btn.remove(),self.isLoading||self.insertLoadingSpinner();var response=self.loadResults();response&&response.then(function(){settings.service.pn>2&&self.infiniteScroll()}).then(function(response){return self.renderLoadMoreBtn(),response})},setEventHandlers:function(){var self=this,settings=self.settings,selector=settings.selector,dropdown=selector.dropdown,filter=selector.filter,feed=selector.feed,like=feed.like,tile=feed.tile,loadMoreBtn=feed.loadMoreBtn,headingFollow=selector.headingFollow,$doc=$(document);$doc.on("click",loadMoreBtn,function(event){event.preventDefault(),self.loadMore($(this))}).on("click tap touchstart",filter,function(event){event.preventDefault();var $this=$(this),filter=$this.data("uri");self.abortActiveRequest().updateSettings($this,filter).updateTileView($this).highlightActiveFilter($this).updateFeedTitle($this).updateUrl(filter.slice(1)).resetModule().scrollToFeed(0);var response=self.loadResults();response&&response.then(function(response){return self.renderLoadMoreBtn(),response})}).on("change",dropdown,function(event){event.preventDefault();var $select=$(this),$option=$(this.options[this.selectedIndex]),filter=$select.val();self.abortActiveRequest().updateSettings($option,filter).updateUrl(filter.slice(1)).resetModule();var response=self.loadResults();response&&response.then(function(response){return self.renderLoadMoreBtn(),response})}).on("click",like,function(event){event.preventDefault();var sesh=FD.Session;sesh.isSignedIn()?self.like($(this)):sesh.register(document.location.href,{},"activityFeed")}).on("click",headingFollow,function(event){event.preventDefault(),self.showConnections($(this)).scrollToFeed(1e3)}).on("click",tile,function(event){var href,tile,$tile=$(this),$target=$(event.target),parents=$target.parentsUntil(tile),hasAnchorParent=function(){var anchorFound=!1;return parents.each(function(index,element){return element.href?(anchorFound=!0,!1):void 0}),anchorFound}();$target.is("a")||hasAnchorParent||(event.preventDefault(),event.stopPropagation(),href=$tile.data("url"),document.location=href)})},abortActiveRequest:function(){var self=this;return self.$ajax&&4!==self.$ajax.readyState&&self.$ajax.abort(),self},showConnections:function($elem){var self=this,viewport=FD.viewports.viewport().name,uri=$elem.data("uri"),$filter="xs"===viewport?$($elem.data("target-xs")):$($elem.data("target"));return"xs"===viewport?$filter.val(uri).trigger("change"):$filter.trigger("click"),self},checkQueryParams:function(){var filter,self=this,filters=self.settings.filters,queryParams=new FD.Url.QueryString(document.location.search);if(queryParams.data.filter)return filter=queryParams.data.filter,-1!==filters.indexOf(filter)?filter:null},activateFilter:function(filter){var $filter,self=this,viewport=FD.viewports.viewport().name;return"following"===filter&&(filter="follows"),"xs"===viewport?($filter=$(".dd-"+filter),$filter.attr("selected",!0)):($filter=$(".filter-"+filter),self.highlightActiveFilter(null,filter)),self.updateSettings($filter,"/"+filter),self},getFilterElement:function(filter){return $(".filter-"+filter)},scrollToFeed:function(ms){var self=this,settings=self.settings,selector=settings.selector,$htmlBody=$(selector.htmlBody),$feedWrap=$(selector.feed.wrap);return $htmlBody.animate({scrollTop:$feedWrap.offset().top},ms),self},createMessageTiles:function(){var self=this,settings=self.settings,className=settings.className,loadingData={cssClassNames:className.loadingFeed,text:"Loading&hellip;",iconClass:"icon-gk-loading fa-spin"},errorData={cssClassNames:className.errorFeed,text:"Uh Oh!",description:"Seems like there was an issue getting results! Please try refreshing the page.",iconClass:"icon-gk-warning"};return settings.markup.spinner=self.render.tileMessage(loadingData),settings.markup.error=self.render.tileMessage(errorData),self},infiniteScroll:function(off){var self=this;off?self.settings.state.isInfinite=!1:self.settings.state.isInfinite||(self.settings.state.isInfinite=!0,proxy.FD.wait(function(){self.scrollHandle&&FD.unsubscribe(self.scrollHandle),self.scrollHandle=FD.subscribe(FD.scrollTracker.eventName+".down",function(){if(self.isLoadComplete())return FD.unsubscribe(self.scrollHandle);var elementIndex,elementTop,viewportThreshold,feed=self.settings.selector.feed,feedItemsSelector=feed.container+" "+feed.item,$items=$(feedItemsSelector),$win=$(window),threshold="md"==FD.viewports.viewport().name?700:300;if(0===$items.length){feedItemsSelector=feed.container+" "+feed.tile,$items=$(feedItemsSelector),elementIndex=$items.length-1;var $lastItem=$($items[elementIndex]);elementTop=$lastItem.offset().top,viewportThreshold=elementTop-$lastItem.height()}else elementIndex=$items.length-2,elementTop=$($items[elementIndex]).offset().top,viewportThreshold=elementTop-threshold;viewportThreshold<$win.scrollTop()&&self.loadMore()})}))},loadResults:function(){var self=this,settings=self.settings,state=settings.state,service=settings.service,errorMsg=settings.markup.error,feed=settings.selector.feed,$feed=$(feed.container),$spinner=$(feed.spinner),vp=FD.viewports.viewport(),response=self.getFeedData();return response?(settings.$request=response,settings.$request.then(function(json){return 200==json.status&&(state.firstLoad||"md"!==vp.name||self.refreshBigBoxAd(),state.firstLoad||self.publishPageView(),state.firstLoad&&(state.firstLoad=!1),settings.total=json.total||0,0===json.total?self.renderNoResults():(service.pn++,settings.data=json.data.items,self.prepData(settings.data).updateFeedContainer().renderFeed(settings.data).truncateItems().triggerLazyLoader()),self.isLoading=!1),json})["catch"](function(xhr,status,errorThrown){log("Error loading feed data!"),log("Error: "+errorThrown),log("Status: "+status),log("activity feed xhr: ",xhr),$spinner.remove(),$feed.append(errorMsg),self.isLoading=!1})):void 0},getFeedData:function(){var self=this,settings=self.settings,state=settings.state,service=settings.service,vpm=FD.viewports,size="module"===settings.feedType&&vpm.isSmallScreen()?3:20;return self.isLoading?null:(self.isLoading=!0,self.$ajax=$.ajax({url:service.get+state.activeFilter,cache:!1,data:{pn:service.pn,size:size,blockGdpr:FD.Config.gdpr},type:"GET",dataType:"json",xhrFields:{withCredentials:!0}}),promisify(self.$ajax).then(function(response){return response.response}))},highlightActiveFilter:function($elem,filter){var self=this,settings=self.settings,className=settings.className,$filter=$(settings.selector.filter);return $filter.removeClass(className.active),null!==$elem?($elem.addClass(className.active),self):void $(".filter-"+filter).addClass(className.active)},insertBigboxAd:function(){var self=this,selector=self.settings.selector,data={noTower:!0},bigboxAd=self.render.gkBigbox(data),$feed=$(selector.feed.container);$feed.append(bigboxAd)},insertLoadingSpinner:function(){var self=this,settings=self.settings,$spinner=$(settings.selector.spinner),$feed=$(settings.selector.feed.container);0===$spinner.length&&$feed.append(settings.markup.spinner)},prepData:function(data){var self=this,settings=self.settings,util=FD.Util;return $.each(data,function(index,item){switch(item.feedType=settings.feedType,util.isUtcDate(item.submitted)?item.date=util.formatDate(item.submitted):item.date=item.submitted,item.type){case"follow":item.action="followed",item.iconType="profile";break;case"review":item.action=item.text?"reviewed":"rated",item.iconType="write-a-review";break;case"creation":item.action="added a recipe for",item.iconType="genius-bulb";break;case"save":item.action="saved",item.iconType="save";break;case"tweak":item.action="tweaked",item.iconType="tweak";break;case"question":item.action="asked a question about",item.iconType="question";break;case"photo":item.action="added a photo to",item.iconType="camera"}item.rating&&(item.ratingPercentage=20*Number(item.rating)),item.totalTime&&(item.cookTime=new util.CookTime(item.totalTime).toString()),item.reviewCount&&item.reviewCount>=1e3&&(item.reviewCountAbbr=util.number.abbreviate(item.reviewCount))}),settings.data=data,self},publishPageView:function(){var self=this,event=self.settings.event;FD.publish(event.pageView)},refreshBigBoxAd:function(){var self=this,settings=self.settings,adId=$(settings.selector.ad.bigbox).attr("id");try{proxy.SniAds.push(["refreshSlots",[adId]])}catch(e){log&&log("AF: ERROR in refreshSlots module:\n"+e)}},renderFeed:function(data){var feedItem,self=this,settings=self.settings,state=settings.state,vpm=FD.viewports,vp=vpm.viewport(),viewport=vp.name,selector=settings.selector,feed=selector.feed,$feed=$(feed.container),$spinner=$(feed.spinner),tileFilters=settings.tileFilters;return $spinner.remove(),$.each(data,function(index,item){feedItem=$(self.render[settings.renderFunc](item)),item.record_type="activityrecipe";var asset=new FD.Util.Asset(item);feedItem.data("asset",asset),$feed.append(feedItem),state.renderedItems++,("xs"===viewport||"sm"===viewport)&&("userProfile"===settings.pageType&&-1!==tileFilters.indexOf(state.activeFilter)&&"sm"===viewport&&(settings.adInterval=6),state.renderedItems%settings.adInterval===0&&"home"!==settings.pageType&&self.insertBigboxAd())}),"userProfile"===settings.pageType&&"tile"===state.view&&settings.total>7&&"md"===viewport&&vpm.setAdPositions($feed,3),self},isLoadComplete:function(){var self=this,settings=self.settings;return settings.total-settings.state.renderedItems<=0&&"page"==settings.feedType},renderNoResults:function(){var self=this,settings=self.settings,selector=settings.selector,$page=$(selector.page),$feed=$(selector.feed.container),activeFilter=settings.state.activeFilter,items=""!==activeFilter?activeFilter.split("https://www.food.com/")[1]:"activity",data={user:$page.data("username"),itemType:items},noResults=self.render.noResults(data),$wrap=$(settings.selector.feed.wrap);$wrap.hasClass(settings.className.tileView)&&"userProfile"===settings.pageType&&($wrap.removeClass(settings.className.tileView),self.refreshBigBoxAd()),$feed.html(noResults)},renderLoadMoreBtn:function(){var self=this,settings=self.settings;if(!self.isLoadComplete()&&settings.total>0&&!settings.state.isInfinite&&self.render.loadMoreBtn){var $feed=$(settings.selector.feed.container),btn=self.render.loadMoreBtn({loadMoreClass:settings.className.loadMoreClass});$feed.append(btn)}},resetModule:function(){var self=this,settings=self.settings,className=settings.className,state=settings.state,selector=settings.selector,service=settings.service,spinner=settings.markup.spinner,$feed=$(selector.feed.container);return service.pn=1,state.firstLoad=!0,self.scrollHandle&&FD.unsubscribe(self.scrollHandle),settings.adInterval=5,state.renderedItems=0,state.loadMoreClicked=!1,self.infiniteScroll(!0),$feed.empty().removeClass(className.tileContainer).html(spinner),self},stickifyElements:function(){var self=this,selector=self.settings.selector,$filters=$(selector.filterPanel),$ad=$(selector.ad.slot);$filters.length&&$filters.stick_in_parent(),$ad.length&&$ad.stuck({fixedPosition:{top:35},respectBottomThreshhold:!0})},triggerLazyLoader:function(){var $win=$(window);return $win.trigger("scroll"),this},truncateItems:function(){var self=this,settings=self.settings,$text=$(settings.selector.feed.text);return"module"!==settings.feedType?self:($.each($text,function(prop,val){var $val=$(val),height=$val.innerHeight(),scrollHeight=val.scrollHeight;if(scrollHeight>height){var truncate=new FD.Util.LineTruncator($val,{maxLines:5,truncateNow:!0,on:{expand:self.truncateShow}});$text.data("truncate",truncate)}}),self)},truncateShow:function(e){e.preventDefault();var tr=this,$li=tr.$element,fullText=tr.lines.join(" ").trim();$li.html(fullText),$li.addClass("expand")},updateFeedTitle:function($elem,custom){var self=this,settings=self.settings,$feedTitle=$(settings.selector.feed.title),title=$elem?$elem.data("title"):custom;return $feedTitle.text(title),self},updateFeedContainer:function(){var self=this,settings=self.settings,$feed=$(settings.selector.feed.container),className=settings.className,activeFilter=settings.state.activeFilter,tileFilters=settings.tileFilters;return"userProfile"!==settings.pageType?self:(-1!==tileFilters.indexOf(activeFilter)?$feed.addClass(className.tileContainer):$feed.removeClass(className.tileContainer),self)},updateSettings:function($elem,filter){var self=this,settings=self.settings;return settings.state.activeFilter=filter,"userProfile"===settings.pageType&&$elem.data("render")?settings.renderFunc=$elem.data("render"):settings.renderFunc="feedItem",self},updateTileView:function($elem){var self=this,settings=self.settings,state=settings.state,$wrap=$(settings.selector.feed.wrap),tileView=settings.className.tileView;return"userProfile"!==settings.pageType?self:($elem.data("tile-view")?($wrap.addClass(tileView),state.view="tile"):($wrap.removeClass(tileView),state.view="default"),self)},updateUrl:function(filter){var self=this,settings=self.settings,query="?filter="+filter;return"userProfile"===settings.pageType&&"follows"===query&&(query="following"),""===filter?window.history.replaceState(null,FD.Page.title(),document.URL.split("?")[0]):window.history.replaceState(null,FD.Page.title(),query),self},like:function($elem){var pubSubData,url,self=this,settings=self.settings,likeCount=settings.selector.feed.likeCount,className=settings.className,itemType=$elem.data("item-type"),itemId=$elem.data("item-id"),recipeId=$elem.data("recipe-id"),$countContainer=$elem.siblings(likeCount),count=""===$countContainer.html()?0:parseInt($countContainer.html()),processLike=function(reqType){url=settings.service.post(recipeId)+"/"+itemType+"s/"+itemId+"/like",$.ajax({url:url,cache:!1,type:reqType,dataType:"json",xhrFields:{withCredentials:!0}}).done(function(json){200==json.status&&(pubSubData={type:json.params.itemType,recipeId:json.params.recipeId},"reply"===pubSubData.type&&(pubSubData.parentType=json.params.parentType),FD.publish("fd.af.like",[pubSubData]))}).fail(function(xhr,status,errorThrown){log("Error with like API!"),log("Error: "+errorThrown),log("Status: "+status),log("activity feed xhr: ",xhr)})};$elem.toggleClass(className.liked),$elem.hasClass(className.liked)?(processLike("POST"),$countContainer.html(count+1)):(processLike("DELETE"),count-=1,$countContainer.html(0===count?"":count))}},proxy.FD.extend(["Module.AllActivity",AllActivity]),proxy.FD.push(["emit","gk.emit.activity.init",[AllActivity]])}),proxy.jQuery.wait(function(){proxy.FD.wait(function(){var serviceApiUrl=new FD.Url(https://www.food.com/FD.Config.saves.apiUrl),apiKey=FD.Config.saves.apiKey;FD.SavesService={getCards:function(jwt){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"cards?page=1&sort=added&reverse=true&pageSize=10",success:function(data){resolve(data)},error:reject,method:"GET",crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})},getCollections:function(jwt,cardId){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"folders?sort=title&cardId="+cardId,success:function(data){resolve(data)},error:reject,method:"GET",crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})},addCollection:function(jwt,title){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"folders",success:function(data){resolve(data.results[0])},error:reject,method:"POST",data:{title:title},crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})},saveFolder:function(jwt,title){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"folders",success:resolve,error:reject,method:"POST",data:{title:title},crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})},saveCard:function(jwt,recipeId){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"cards",success:resolve,error:reject,method:"POST",data:{recipeId:recipeId},crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})},addCardToFolder:function(jwt,folderId,cardId){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"folders-with-cards/"+folderId+"/cards/"+cardId,success:resolve,error:reject,method:"PUT",crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})},deleteCardFromFolder:function(jwt,folderId,cardId){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"folders-with-cards/"+folderId+"/cards/"+cardId,success:resolve,error:reject,method:"DELETE",crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})},deleteCard:function(jwt,cardId){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"cards/"+cardId,success:resolve,error:reject,method:"DELETE",crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})},getCardForRecipe:function(jwt,recipeId){return new Promise(function(resolve,reject){$.ajax({url:serviceApiUrl+"cards/recipeId/"+recipeId,success:function(data){resolve(data.results[0])},error:reject,method:"GET",crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+jwt),xhr.setRequestHeader("X-API-KEY",apiKey)}})})}}})}),function(){function WelcomeBanner(options){var self=this;self.settings=$.extend(!0,{},defaults,options||{}),self.init()}var defaults={selector:{module:".gk-welcome-banner",save:".gk-welcome-banner .rb-open",spinner:".gk-welcome-banner .fd-spinner",templates:".module-welcome-banner"}};WelcomeBanner.prototype={init:function(){var self=this,templates=self.settings.selector.templates;FD.Util.createRenderFunctions(self,templates),self.setEventHandlers().refreshBanner()},refreshBanner:function(){var self=this;FD.Session.isSignedIn()?self.checkSavedRecipes():self.checkViewedRecipes().showMessage()},storeSavedData:function(data,response,jqXHR){var recipeData,self=this,settings=self.settings;data&&"undefined"!=typeof data.results&&data.results.length>0?(recipeData=self.pruneData(data.results),settings.message=recipeData?{type:"welcomeSaved",data:recipeData}:self.checkViewedRecipes()):self.checkViewedRecipes()},setEventHandlers:function(){var self=this,selector=self.settings.selector,save=selector.save,$module=$(selector.module);return $module.on("click",save,function(event){event.preventDefault()}),FD.subscribe("fd.recipe-box.folder.addto.success",function(){FD.publish("GK.welcomebanner.refresh",[])}),FD.subscribe("GK.welcomebanner.refresh",function(){self.settings.message={type:"welcomeLoading",data:{}},self.showMessage(),self.refreshBanner()}),FD.Session.onRefresh(function(){FD.publish("GK.welcomebanner.refresh")}),self},checkSavedRecipes:function(){var self=this,service=self.settings.service,saves=service.savesInfo,savesUrl=saves.apiUrl;saves.apiKey,savesUrl+service.get.saved;FD.Session.getJwt().then(function(token){FD.SavesService.getCards(token.value).then(function(cardData){self.storeSavedData(cardData),self.showMessage()})["catch"](function(){self.showMessage()})})["catch"](function(){self.checkViewedRecipes(),self.showMessage()})},checkViewedRecipes:function(){var self=this,settings=self.settings,data=localStorage.fd?JSON.parse(localStorage.fd):null;return data&&data.viewedAssets&&0!==data.viewedAssets.length?settings.message={type:"welcomeViewed",data:data.viewedAssets[0]}:settings.message={type:"welcomeDefault",data:FD.Data.welcomeBanner||{noData:!0}},self},pruneData:function(arr){var recipe=null;return arr.forEach(function(item,index){"fdc"===item.recipe.type&&null==recipe&&(recipe=item.recipe)}),recipe},showMessage:function(){var self=this,settings=self.settings,message=settings.message,selector=settings.selector,$module=$(selector.module);if(message.data.noData)$module.remove();else{message.data["class"]="undefined"!=typeof FD.Session.user&&FD.Session.user.userDisplayName===message.data.author?"self":"other";var msgText=self.render[message.type](message.data);$module.empty(),$module.append(msgText)}}},proxy.FD.extend(["Module.WelcomeBanner",WelcomeBanner])}(),proxy.jQuery.wait(function(){"use strict";function VideoPromo(){var self=this;self.settings=$.extend(!0,{},defaults),self.init()}var defaults={moduleName:"gk-video-promo",invalidFormClass:"invalid-input-format",selector:{videoPromo:".gk-video-promo",embed:".gk-video-embed",iframe:" iframe",subscriptionForm:".newsletter-subscription",formContainer:".gk-video-container .form-container"},events:{newsletterSubscriptionSuccess:"fd.newsletter.signup.success"}};VideoPromo.prototype={init:function(){var self=this;self.setFrameSource(),self.setEventHanders()},setFrameSource:function(){var self=this,settings=self.settings,selector=settings.selector,embed=selector.embed,$embed=$(embed),$iframe=$(selector.videoPromo+selector.iframe);$iframe.attr("height",$embed.height()).attr("width",$embed.width()).attr("src",$iframe.data("src"))},setEventHanders:function(){var self=this,settings=self.settings,selector=settings.selector,$form=$(selector.subscriptionForm),$email=$("."+$form.data("input-email"));$email.on("keyup",function(e){var email=$(this).val();FD.Util.isValidEmail(email)||""===email?$form.removeClass(settings.invalidFormClass):$form.addClass(settings.invalidFormClass)}),$form.on("submit",function(e){e.preventDefault();var email=$email.val();return FD.Util.isValidEmail(email)?($form.removeClass(settings.invalidFormClass),""!==email.trim()?(FD.NewsletterService.subscribe(email,{source:"GK_VIDEO_PROMO"}),!1):void 0):($form.addClass(settings.invalidFormClass),!1)}),FD.subscribe(settings.events.newsletterSubscriptionSuccess,function(){var container=$(selector.formContainer),msg='<div class="form-success"><i class="icon-gk-check"></i> Yasss, you\'re in!</div>';container.html(msg)})}},proxy.FD.extend(["Module.VideoPromo",VideoPromo]),proxy.FD.push(["publish","video-promo-loaded"])}),proxy.FD.push(["Session.onConfig",function(){function TopGalleries(options){var self=this;self.settings=$.extend(!0,{},defaults,options||{}),self.init()}var defaults={selector:{module:{spinner:".fd-spinner",tileContainer:".tile-container"},target:{topCollection:".target-top-collections",cravingNow:".target-what-were-craving"},templates:{topGalleries:".module-top-galleries",slideshowTile:"#tile-slideshow"}},service:{collections:"/services/mobile/configuration/site/hp/middle/collections"}};TopGalleries.prototype={init:function(){var self=this,settings=self.settings,moduleTypes=settings.moduleTypes;self.getCollections().done(function(data){$.each(moduleTypes,function(index,item){self.createRenderFunctions(),self.renderModule(item),self.renderTiles(self.prepareData(data[item]),item)})})},getCollections:function(){var self=this,service=self.settings.service,url=FD.Config.secureServerURL+service.collections;return $.ajax({url:url,cache:!1,type:"GET"})},prepareData:function(data){var self=this,preparedData=[],widescaleTileIndex=self.getWidescaleTileIndex(data);return $.each(data,function(index,item){preparedData.push({ss_id:self.getSSId(item.link),record_url:item.link,title:item.title,title_truncated:item.title,primary_photo_url:item.photo,isWidescale:widescaleTileIndex===index})}),preparedData},getSSId:function(url){var splitted=url.split("-");return splitted[splitted.length-1]},getWidescaleTileIndex:function(tiles){return tiles&&tiles.length%2===1?Math.floor(tiles.length/2):-1},renderModule:function(moduleType){var self=this,settings=self.settings,$target=$(settings.selector.target[moduleType]),data={moduleTitle:$target.data("title")},module=self.renderContainer(data);$target.append(module)},renderTiles:function(data,moduleType){var tile,self=this,settings=self.settings,selector=settings.selector,module=selector.module,$target=$(selector.target[moduleType]).find(module.tileContainer);$target.find(module.spinner).remove(),$.each(data,function(index,item){item.label="photos",item.record_type="slideshow",item.record_spec="";var asset=new FD.Util.Asset(item);tile=self.renderTile(asset),$target.append(tile)})},createRenderFunctions:function(){var self=this,settings=self.settings,templates=settings.selector.templates;self.renderContainer=doT.template($(templates.topGalleries).html()),self.renderTile=doT.template($(templates.slideshowTile).html())}},proxy.FD.extend(["Module.TopGalleries",TopGalleries])}]),proxy.FD.push(["Session.onConfig",function(){FD.Page.refreshOnLogin=!1,FD.Module.featurePromo=new FD.Module.FeaturePromo({photoSettings:{xs:{w:414,h:270,mode:"fill",q:80},sm:{w:776,h:440,mode:"fill",q:80},md:{w:1025,h:437,mode:"fill",q:80}}}),FD.Module.trendingRecipes=new FD.Module.NewRecipes({moduleType:"trending"}),FD.Module.topGalleries=new FD.Module.TopGalleries({moduleTypes:["topCollection","cravingNow"]}),FD.Module.newRecipes=new FD.Module.NewRecipes({moduleType:"new"}),FD.Module.allActivity=new FD.Module.AllActivity({feedType:"module",pageType:"home",selector:{feed:{container:".gk-af-sum-feed",spinner:".gk-af-sum-feed .loading-feed"},template:{feedItem:"#gk-af-sum-item"}},service:{get:FD.Config.secureServerURL+"/external/v1/feed/home"}})}]),proxy.FD.push(["listener","gk.emit.welcomebanner",function(data){var fc=FD.Config,fs=FD.Session;proxy.FD.extend(["Data.welcomeBanner",data]),proxy.FD.push(["Session.onReady",function(){FD.Module.welcomeBanner=new FD.Module.WelcomeBanner({service:{domain:fc.serverURL,domainSecure:fc.secureServerURL,savesInfo:fc.saves,get:{activity:function(){return fs.isSignedIn()?"/external/v1/members/"+fs.user.memberId+"/feed":null}(),saved:"cards?page=1&sort=added&reverse=true&pageSize=1"}}})}]),FD.Page.Image.lazyload.start()}]);