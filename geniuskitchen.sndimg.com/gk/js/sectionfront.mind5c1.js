proxy.FD.wait(function(){var pageMarker="data-ts-pn",pageParam="pn",vp=FD.viewports.viewport(),tiles={settings:{offset:1.5*vp.screen.height,infiniteScroll:!1,adRowFrequency:8,adRowStart:{xs:3,sm:2,md:2,lg:2},adStartRow:[-1,3,3,2,2],events:{beforeLoad:"ts.stream.beforeload",load:"ts.stream.load",loading:"ts.stream.loading",loaded:"ts.stream.loaded",loadError:"ts.stream.loadError",feedChanged:"ts.stream.page.changed",scrolled:"ts.stream.scrolled",beforePageView:"ts.omniture.beforepageview.fire",pageView:"ts.omniture.pageview.fire",init:"ts.stream.init"},selector:{ad:{tile:".fd-tile-ad",tall:".ad-tall",tower:".ad-tower",dfp:".dfp",placeholder:".placeholder"},tile:{base:".fd-tile:visible, .gk-tile:visible","double":".fd-tile-double",full:".fd-tile-quadro"},content:".gk-tile-content:not(.featured-tiles) .tile-stream",container:".gk-tile-content",page:"["+pageMarker+"]",template:'script[type="text/html-template"][id].tile-template',editorialContent:".gk-tile-content.featured-tiles > .tile-stream",loading:".tile-message.loader",footer:".gk-tile-footer"},ajax:{type:"GET",dataType:"json",contentType:"application/json"},page:{collectionIdParam:"id",containerIdParam:pageParam,sortByParam:"sortBy",useLocation:!0},render:{message:"tileMessage"}},init:function(options){var ts=this;return options&&$.extend(!0,ts.settings,options),pageMarker=ts.settings.selector.page.replace(/[[\]]/g,""),ts.instance.id&&(ts.settings.ajax.data[ts.settings.page.collectionIdParam]=FD.Page.Tiles.instance.id),ts.settings.initialPage=ts.getCurrentPageNumber(),"undefined"!=typeof window.pageSettings&&(ts.settings.ajax.data[ts.settings.page.sortByParam]=window.pageSettings.sortBy),ts.$content=$(ts.settings.selector.content),ts.$container=$(ts.settings.selector.container),ts.loadingTile=$(ts.settings.selector.loading).outerHtml(),ts.recordTotal=0,ts.data={editorial:[],results:["no 0 page"]},ts.initStream(),ts.initEvents(),FD.subscribe(ts.settings.events.pageView,FD.Page.event.pageView),ts},initStream:function(){var ts=this,options=ts.settings;return ts.stream=new FD.Page.Stream(options),ts.stream.loadComplete=function(){return ts.recordTotal>=ts.expectedTotal},ts.stream.onInit(function(){ts.loadInitialData()}),ts.stream.onBeforeLoad(function(){ts.beforeLoad()}),ts.stream.onLoad(function(promise){ts.processData(promise)}),ts.stream.onLoad(function(){var $loading=$(options.selector.loading);$loading.length>0&&ts.removeLoadMore()}),ts.stream.ajax.data=ts.settings.ajax.data,ts.stream.init(),ts},loadInitialData:function(){var ts=this;return"undefined"!=typeof initialData?ts.processData(Promise.resolve().then(function(){return{response:initialData}})):ts.stream.load(),ts},beforeLoad:function(){var ts=this,stream=ts.stream,ajax=stream.ajax,data=ajax.data,pn=data[pageParam];data[pageParam]="string"==typeof pn?parseInt(pn)+1:pn+1,data[pageParam]<1&&(data[pageParam]=1),stream.firstLoad&&stream.updateUrlState()},processData:function(promise){var ts=this;if(promise&&ts.stream){var preprocessData=ts.settings.preprocessData;preprocessData&&"function"==typeof preprocessData&&promise.then(preprocessData),promise.then(ts.stream.translateResponse).then(ts.addRecordCount()).then(ts.saveResults()).then(ts.renderEditorialContent()).then(ts.renderResults()).then(function(promise){ts.stream.firstLoad&&ts.loadMore()})["catch"](ts.loadingError())}return ts},loadingError:function(){var ts=this;return function(error){debug=FD.Config.isDev,log("ERROR in tile-stream.js: ",error),ts.stream.showMessage("error")}},saveResults:function(){var ts=this;return function(response){var editorialResults=response.editorialResults,results=response.results;return editorialResults&&ts.data.editorial.push(editorialResults),results&&ts.data.results.push(results),response}},addRecordCount:function(){var ts=this;return function(response){response.totalResultsCount||(response.totalResultsCount=response.totalResults||0),response.results||(response.results=response.episodes),response.parameters||(response.parameters={numRecords:response.size,pn:ts.stream.ajax.data.pn-1});var parameters=response.parameters;return ts.expectedTotal=response.totalResultsCount&&parseInt(response.totalResultsCount)||0,ts.recordTotal+=parseInt(parameters.numRecords),response}},renderEditorialContent:function(){var ts=this,selector=ts.settings.selector;return function(response){var editorialData=response.editorialResults,$editorialContent=$(selector.editorialContent);return $(".gk-tile-content.featured-tiles.ssr-content").remove(),editorialData&&editorialData.length&&(editorialData.forEach(function(tile,idx){tile&&(tile.cssClassNames="full"==tile.layout?"fd-tile-quadro":"fd-tile-double",tile.isFeatured=!0)}),$editorialContent.parent().show(),ts.stream.firstLoad&&(ts.renderAssets($editorialContent,editorialData),FD.Page.Image.lazyload.start())),response}},renderResults:function(){var ts=this,selector=ts.settings.selector,$tileContainer=$(selector.content);return function(response){var results=response.results;return ts.addLoadingTile().renderAssets($tileContainer,results).removeLoadingTile(),FD.Config.gdpr!==!0&&ts.insertAd(),response}},renderAssets:function($container,data){var ts=this;return data&&data.length&&$container.length&&data.forEach(function(asset,idx){if(asset&&!asset.html&&"Package"!=asset.record_type){var tile=new FD.Util.Asset(asset),$tile=$(tile.render());0===idx&&$tile.attr(pageMarker,ts.stream.ajax.data[pageParam]),$container.append($tile),$tile.data("asset",tile)}}),ts},addLoadingTile:function(){var ts=this,selector=ts.settings.selector,$container=$(selector.content),$loading=$container.find(selector.loading);return 0===$loading.length&&($loading=$(ts.loadingTile)),$container.append($loading),ts},removeLoadingTile:function(){var ts=this;return ts.stream.clearMessage(),ts},initEvents:function(){var ts=this,selector=ts.settings.selector;ts.$container.on("click",selector.tile.base,function(e){var $target=$(e.target),$link=$target.parents("a"),$tile=$target.parents(selector.tile.base),url=$tile.data("url");$link.length&&($target=$link.first()),$target.is("a")&&"#"!=$target.attr("href")&&(url=$target.attr("href")),url&&(location.href=url)})},removeLoadMore:function(){$(".gk-aa-load-more").remove()},getCurrentPageNumber:function(){var url=new FD.Url(location.href),qs=url.querystring,qData=qs.data,page=qData.pn?qData.pn:this.settings.ajax.data.pn;return isNaN(page)&&(page=0),parseInt(page)},loadMore:function(){var ts=this,stream=ts.stream,selector=ts.settings.selector,$footer=$(selector.footer),render=ts.stream.render.loadMoreBtn;if(0===ts.expectedTotal&&ts.recordTotal>0&&log.warn("[tile-stream.js] The tile page API service loaded data, but is reporting 0 total records",stream.settings.ajax),0===ts.expectedTotal&&0===ts.recordTotal){var msg={text:"Oops!",description:"There is no content to load yet.",type:"oops"};ts.stream.showMessage(!1,msg)}else!stream.loadComplete()&&stream.firstLoad&&(stream.firstLoad=!1,$footer.append(render({loadMoreClass:"gk-aa-load-more",nextPage:ts.getCurrentPageNumber()+1})),$(".gk-tile-footer").on("click",".gk-aa-load-more",function(){ts.stream.startInfiniteScroll(),ts.stream.load($(this).data("next-page")||1);var $scrContainer=stream.getScrollContainer();$scrContainer&&$scrContainer.length&&$scrContainer.scroll()}))},insertTile:function($tiles,index,$newTile){$tiles.eq(index).before($newTile)},getBigboxTile:function(){var ts=this;return $(ts.stream.render.tileAd())},insertAd:function(){var startIndex,adjustedTileCount,tileCount,tileCountOffset,ts=this,$bb=ts.getBigboxTile(),settings=ts.settings,selector=settings.selector,$tiles=ts.getTiles(),$adTiles=ts.getAdTiles(),$lastAd=$adTiles.last(),lastAdIndex=$tiles.index($lastAd),tilesPerRow=ts.getTilesPerRow(),adRowFrequency=settings.adRowFrequency,startRow=settings.adStartRow[tilesPerRow],adRowCount=0,adColumnCount=FD.viewports.isSmallScreen()?1:2,tileColumnCount=1;tileCount=0>lastAdIndex?tilesPerRow*startRow:tilesPerRow*adRowFrequency,$lastAd.is(selector.ad.tower)?adRowCount=2:$lastAd.is(selector.ad.tall)&&(adRowCount=1),tileCountOffset=adColumnCount-tileColumnCount+adRowCount*adColumnCount,adjustedTileCount=tileCount-tileCountOffset,startIndex=lastAdIndex+adjustedTileCount,$tiles.length>startIndex?ts.insertTile($tiles,startIndex,$bb):$tiles.length<=adjustedTileCount&&$tiles.length==ts.expectedTotal&&ts.$content.append($bb)},getTilesPerRow:function($container,$tile){var ts=this;$container=$container||ts.$content;var containerWidth,tileWidth,settings=ts.settings,selector=settings.selector,$tiles=$container.find(selector.tile.base).not(selector.tile["double"]).not(selector.tile.full);return $tile=$tile||$tiles.first(),containerWidth=$container.width(),tileWidth=$tile.width(),Math.floor(containerWidth/tileWidth)},getTiles:function($container,excludeSelector){var $tiles,ts=this,selector=ts.settings.selector;return $container=$container||ts.$content,$tiles=$container.find(selector.tile.base),excludeSelector?$tiles.not(excludeSelector):$tiles},getAdTiles:function(){var ts=this,adSelector=ts.settings.selector.ad,$tiles=ts.getTiles(),$adTiles=$tiles.filter(adSelector.tile);return $adTiles},insertNativeAdPlaceholder:function(){var ts=this,tilesPerRow=ts.getTilesPerRow(),$tiles=ts.getTiles(),tileCount=$tiles.length,$placeholder=$(ts.stream.render.tileMessage({title:"placeholder",type:"placeholder"})).hide();tileCount>=tilesPerRow&&ts.insertTile($tiles,tilesPerRow,$placeholder)},getNativeAdPlaceholder:function(){var ts=this,selector=ts.settings.selector,placeholder=selector.ad.placeholder,adTile=selector.ad.tile,$placeholderTile=$("{0} {1}".format(adTile,placeholder));return $placeholderTile},insertNavtiveAdTile:function(markup){var ts=this,$placeholder=ts.getNativeAdPlaceholder(),$markup=markup.jquery?markup:$(markup);return $placeholder.replace($markup),$placeholder}};proxy.FD.extend(["Page.Tiles",tiles])}),proxy.FD.wait(function(){var pageMarker="data-sf-pn",page={settings:{selector:{heading:".fd-header-wrap",filters:".tile-filters"},api:{url:FD.Config.secureServerURL+"/services/mobile/fdc/search/sectionfront",data:{pn:1}}},init:function(pageSettings){var tp=this;return tp.name="tile-page-sectionfront",pageSettings&&$.extend(!0,tp,pageSettings),tp.tabs(),tp.tiles(),tp},globalShare:function(){var tp=this;return tp},heading:function(template,data){var tp=this,$heading=$(tp.settings.selector.heading),render=doT.template(template);return $heading.html(render(data)),tp},tabs:function(){var tp=this,$filters=$(tp.settings.selector.filters),mbConfig=FD.Config.magicButtons||null;return $filters.length&&mbConfig&&(tp.magicButtons=$filters.magicButtons({selector:{module:tp.settings.selector.filters},template:{tab:'<li data-id="{{=it.id}}"><a href="'+mbConfig.baseUrl+'/{{=it.id}}">{{=it.label}}</a></li>'}},mbConfig.data)),tp},tiles:function(){var tp=this,spec=tp.settings,containerIdParam=$.camelCase(pageMarker.replace("data-","")),streamOptions={ajax:spec.api,selector:{page:"["+pageMarker+"]"},page:{collectionIdParam:"collectionId",containerIdParam:containerIdParam}};return tp.type&&(streamOptions.ajax.data.recordType=tp.type),tp.sortBy&&(tp.settings.api.data.sortBy=tp.sortBy),FD.Page.Tiles.init(streamOptions),tp}};proxy.jQuery.push(["",function(){proxy.FD.push(["listener","gk.emit.page.settings",function(fnSettings){var pageSettings=fnSettings&&fnSettings();proxy.FD.extend(["Page.Tiles.instance",page]),FD.Page.Tiles.instance.init(pageSettings)}])}])});